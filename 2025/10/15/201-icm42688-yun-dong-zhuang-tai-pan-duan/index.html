<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="南北的猫" />
  <!-- Open Graph Description 简短摘要-->
  
  <!-- 用于搜索引擎的文章摘要 -->
  
  
  
  <title>
    
      201-ICM42688运动状态判断 
      
      
      |
    
     南北的猫
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  
    
<link rel="stylesheet" href="/css/figcaption/mac-block.css">

  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Northcat</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">201-ICM42688运动状态判断</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2025-10-17 14:32:03
        </span>
        
      </div>
      <div class="markdown-body">
        <h1 id="ICM42688-运动状态识别系统"><a href="#ICM42688-运动状态识别系统" class="headerlink" title="ICM42688 运动状态识别系统"></a>ICM42688 运动状态识别系统</h1><h2 id="📋-功能简介"><a href="#📋-功能简介" class="headerlink" title="📋 功能简介"></a>📋 功能简介</h2><h3 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h3><ul>
<li>✅ <strong>实时识别</strong>：每秒更新一次状态</li>
<li>✅ <strong>高准确率</strong>：多特征融合分类算法</li>
<li>✅ <strong>低功耗</strong>：20Hz 采样率</li>
<li>✅ <strong>状态平滑</strong>：3秒滑动窗口避免误判</li>
</ul>
<hr>
<h2 id="🔬-工作原理"><a href="#🔬-工作原理" class="headerlink" title="🔬 工作原理"></a>🔬 工作原理</h2><h3 id="1-数据采集"><a href="#1-数据采集" class="headerlink" title="1. 数据采集"></a>1. 数据采集</h3><p>从 ICM42688 传感器读取：</p>
<ul>
<li><strong>加速度计</strong>：测量三轴加速度 (aX, aY, aZ)，单位：g</li>
<li><strong>陀螺仪</strong>：测量三轴角速度 (gX, gY, gZ)，单位：度&#x2F;秒</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">采样率：20Hz (每 100ms 采集一次)
窗口大小：1 秒 (10 个样本)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="2-特征提取"><a href="#2-特征提取" class="headerlink" title="2. 特征提取"></a>2. 特征提取</h3><p>从 1 秒窗口的数据中提取以下特征：</p>
<h4 id="特征-1-加速度标准差-Accel-Std"><a href="#特征-1-加速度标准差-Accel-Std" class="headerlink" title="特征 1: 加速度标准差 (Accel Std)"></a>特征 1: 加速度标准差 (Accel Std)</h4><pre class="line-numbers language-none"><code class="language-none">计算公式：std &#x3D; √(Σ(ai - mean)² &#x2F; N)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>含义</strong>：反映运动强度</li>
<li><strong>静止</strong>: 标准差很小 (~0.02g)</li>
<li><strong>走路</strong>: 中等标准差 (~0.1-0.3g)</li>
<li><strong>跑步</strong>: 高标准差 (&gt;0.4g)</li>
</ul>
<h4 id="特征-2-陀螺仪均值-Gyro-Mean"><a href="#特征-2-陀螺仪均值-Gyro-Mean" class="headerlink" title="特征 2: 陀螺仪均值 (Gyro Mean)"></a>特征 2: 陀螺仪均值 (Gyro Mean)</h4><pre class="line-numbers language-none"><code class="language-none">计算公式：gyro_mag &#x3D; √(gX² + gY² + gZ²)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>含义</strong>：反映旋转运动</li>
<li><strong>静止</strong>: 陀螺仪接近 0</li>
<li><strong>走路</strong>: 中等旋转 (5-15 dps)</li>
<li><strong>驾车</strong>: 持续旋转 (&gt;3 dps)</li>
</ul>
<h4 id="特征-3-步频-Step-Frequency"><a href="#特征-3-步频-Step-Frequency" class="headerlink" title="特征 3: 步频 (Step Frequency)"></a>特征 3: 步频 (Step Frequency)</h4><pre class="line-numbers language-none"><code class="language-none">检测方法：峰值检测算法<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>含义</strong>：每秒的步数</li>
<li><strong>静止</strong>: 0 Hz</li>
<li><strong>走路</strong>: 0.8-2.5 Hz (约 1.5-2.0 步&#x2F;秒)</li>
<li><strong>跑步</strong>: &gt;2.2 Hz (&gt;2.2 步&#x2F;秒)</li>
</ul>
<h4 id="特征-4-过零率-Zero-Crossings"><a href="#特征-4-过零率-Zero-Crossings" class="headerlink" title="特征 4: 过零率 (Zero Crossings)"></a>特征 4: 过零率 (Zero Crossings)</h4><pre class="line-numbers language-none"><code class="language-none">统计信号穿越均值的次数<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>含义</strong>：反映运动规律性</li>
<li><strong>走路&#x2F;跑步</strong>: 有规律的周期性，过零少</li>
<li><strong>驾车</strong>: 不规则振动，过零多</li>
</ul>
<h3 id="3-分类规则"><a href="#3-分类规则" class="headerlink" title="3. 分类规则"></a>3. 分类规则</h3><p>基于多特征决策树：</p>
<pre class="line-numbers language-none"><code class="language-none">┌─────────────────────────────────────┐
│  加速度标准差 &lt; 0.08g               │
│  且 陀螺仪均值 &lt; 5 dps              │
└────────┬────────────────────────────┘
         │ Yes
         ↓
    【静止状态】

         │ No
         ↓
┌─────────────────────────────────────┐
│  步频 0.8-2.5 Hz                    │
│  且 加速度标准差 0.08-0.5g          │
└────────┬────────────────────────────┘
         │ Yes
         ↓
    【走路状态】

         │ No
         ↓
┌─────────────────────────────────────┐
│  步频 &gt; 2.2 Hz                      │
│  且 加速度标准差 &gt; 0.4g             │
└────────┬────────────────────────────┘
         │ Yes
         ↓
    【跑步状态】

         │ No
         ↓
┌─────────────────────────────────────┐
│  陀螺仪均值 &gt; 3 dps                 │
│  且 步频 &lt; 1.5 Hz                   │
└────────┬────────────────────────────┘
         │ Yes
         ↓
    【驾车状态】<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-状态平滑"><a href="#4-状态平滑" class="headerlink" title="4. 状态平滑"></a>4. 状态平滑</h3><p>使用滑动窗口投票机制：</p>
<pre class="line-numbers language-none"><code class="language-none">保存最近 3 秒的识别结果 [状态1, 状态2, 状态3]
统计每种状态的票数
选择票数最多的状态作为最终输出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>优点</strong>：避免状态频繁跳变，提高稳定性</p>
<hr>
<h2 id="🎯-技术实现"><a href="#🎯-技术实现" class="headerlink" title="🎯 技术实现"></a>🎯 技术实现</h2><h3 id="硬件平台"><a href="#硬件平台" class="headerlink" title="硬件平台"></a>硬件平台</h3><ul>
<li><strong>MCU</strong>: ESP32 系列</li>
<li><strong>传感器</strong>: ICM42688 六轴 IMU</li>
<li><strong>接口</strong>: I2C (400kHz)</li>
</ul>
<h3 id="传感器配置"><a href="#传感器配置" class="headerlink" title="传感器配置"></a>传感器配置</h3><ul>
<li><strong>加速度计</strong>: ±16g 量程, 1kHz ODR</li>
<li><strong>陀螺仪</strong>: ±2000dps 量程, 1kHz ODR</li>
<li><strong>工作模式</strong>: 低噪声模式 (Low Noise Mode)</li>
</ul>
<h3 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h3><pre class="line-numbers language-none"><code class="language-none">┌──────────────┐
│  读取传感器  │ ← 10Hz 采样
└──────┬───────┘
       ↓
┌──────────────┐
│ 存入缓冲区   │ ← 1秒窗口 (10个样本)
└──────┬───────┘
       ↓
┌──────────────┐
│  提取特征    │ ← 计算标准差、峰值、步频等
└──────┬───────┘
       ↓
┌──────────────┐
│  规则分类    │ ← 基于阈值的决策树
└──────┬───────┘
       ↓
┌──────────────┐
│  状态平滑    │ ← 3秒滑动窗口投票
└──────┬───────┘
       ↓
┌──────────────┐
│  输出结果    │
└──────────────┘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="📊-特征对比表"><a href="#📊-特征对比表" class="headerlink" title="📊 特征对比表"></a>📊 特征对比表</h2><table>
<thead>
<tr>
<th>状态</th>
<th>加速度标准差</th>
<th>陀螺仪均值</th>
<th>步频</th>
<th>典型特征</th>
</tr>
</thead>
<tbody><tr>
<td>🧍 <strong>静止</strong></td>
<td>&lt; 0.08g</td>
<td>&lt; 5 dps</td>
<td>0 Hz</td>
<td>几乎无变化</td>
</tr>
<tr>
<td>🚶 <strong>走路</strong></td>
<td>0.08-0.5g</td>
<td>5-15 dps</td>
<td>0.8-2.5 Hz</td>
<td>规律的周期性摆动</td>
</tr>
<tr>
<td>🏃 <strong>跑步</strong></td>
<td>&gt; 0.4g</td>
<td>10-30 dps</td>
<td>&gt; 2.2 Hz</td>
<td>高频、大幅度运动</td>
</tr>
<tr>
<td>🚗 <strong>驾车</strong></td>
<td>0.05-0.4g</td>
<td>&gt; 3 dps</td>
<td>&lt; 1.5 Hz</td>
<td>不规则、持续振动</td>
</tr>
</tbody></table>
<hr>
<h2 id="🔧-优化方向"><a href="#🔧-优化方向" class="headerlink" title="🔧 优化方向"></a>🔧 优化方向</h2><ol>
<li><strong>增加传感器融合</strong>：结合 GPS、气压计等</li>
<li><strong>机器学习分类</strong>：使用 SVM、随机森林等算法</li>
<li><strong>自适应阈值</strong>：根据用户行为自动调整</li>
<li><strong>增加状态</strong>：爬楼梯、骑车、游泳等</li>
</ol>
<hr>
<h2 id="📚-参考资料"><a href="#📚-参考资料" class="headerlink" title="📚 参考资料"></a>📚 参考资料</h2><ul>
<li><strong>ICM-42688 数据手册</strong>: <a target="_blank" rel="noopener" href="https://invensense.tdk.com/">TDK InvenSense 官网</a></li>
<li><strong>ESP-IDF 文档</strong>: <a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/">ESP-IDF Programming Guide</a></li>
<li><strong>人体运动识别综述</strong>: <em>Sensor-based Human Activity Recognition: A Review</em> (2019)</li>
</ul>
<h1 id="峰值检测与步频计算原理详解"><a href="#峰值检测与步频计算原理详解" class="headerlink" title="峰值检测与步频计算原理详解"></a>峰值检测与步频计算原理详解</h1><h2 id="1️⃣-采样频率理解"><a href="#1️⃣-采样频率理解" class="headerlink" title="1️⃣ 采样频率理解"></a>1️⃣ 采样频率理解</h2><h3 id="你的理解完全正确！✅"><a href="#你的理解完全正确！✅" class="headerlink" title="你的理解完全正确！✅"></a>你的理解完全正确！✅</h3><pre class="line-numbers language-none"><code class="language-none">采样频率 10Hz &#x3D; 1秒读取10次数据
                &#x3D; 每 100ms 读取一次
                &#x3D; 每 0.1秒 读取一次<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="时间轴示意图"><a href="#时间轴示意图" class="headerlink" title="时间轴示意图"></a>时间轴示意图</h3><pre class="line-numbers language-none"><code class="language-none">时间(秒):  0.0   0.1   0.2   0.3   0.4   0.5   0.6   0.7   0.8   0.9   1.0
           │     │     │     │     │     │     │     │     │     │     │
采样点:    ●─────●─────●─────●─────●─────●─────●─────●─────●─────●─────●
           1     2     3     4     5     6     7     8     9    10    11

窗口大小 &#x3D; 10个采样点 &#x3D; 1秒的数据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="2️⃣-峰值检测的对象"><a href="#2️⃣-峰值检测的对象" class="headerlink" title="2️⃣ 峰值检测的对象"></a>2️⃣ 峰值检测的对象</h2><h3 id="检测的是：加速度幅值（Acceleration-Magnitude）"><a href="#检测的是：加速度幅值（Acceleration-Magnitude）" class="headerlink" title="检测的是：加速度幅值（Acceleration Magnitude）"></a>检测的是：<strong>加速度幅值（Acceleration Magnitude）</strong></h3><h3 id="什么是加速度幅值？"><a href="#什么是加速度幅值？" class="headerlink" title="什么是加速度幅值？"></a>什么是加速度幅值？</h3><p>加速度计给我们三个轴的数据：</p>
<ul>
<li><strong>aX</strong>: X轴加速度</li>
<li><strong>aY</strong>: Y轴加速度</li>
<li><strong>aZ</strong>: Z轴加速度</li>
</ul>
<p><strong>加速度幅值</strong>是三轴的合成：</p>
<pre class="line-numbers language-none"><code class="language-none">加速度幅值 &#x3D; √(aX² + aY² + aZ²)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个值代表<strong>总的加速度大小</strong>，不考虑方向。</p>
<h3 id="为什么要计算幅值？"><a href="#为什么要计算幅值？" class="headerlink" title="为什么要计算幅值？"></a>为什么要计算幅值？</h3><p>因为传感器的方向可能不固定（手机在口袋里可能是竖着、横着、斜着），但<strong>总的运动强度</strong>是不变的。</p>
<hr>
<h2 id="3️⃣-走路时的加速度变化"><a href="#3️⃣-走路时的加速度变化" class="headerlink" title="3️⃣ 走路时的加速度变化"></a>3️⃣ 走路时的加速度变化</h2><h3 id="人走路时发生了什么？"><a href="#人走路时发生了什么？" class="headerlink" title="人走路时发生了什么？"></a>人走路时发生了什么？</h3><p>想象一下走路的过程：</p>
<pre class="line-numbers language-none"><code class="language-none"> 抬脚 → 向前 → 落地 → 抬脚 → 向前 → 落地
  ↑             ↑      ↑             ↑
峰值1         峰值2   峰值3         峰值4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>每走一步，身体都会经历：</p>
<ol>
<li><strong>向上抬脚</strong>：加速度增加 ↗️</li>
<li><strong>向前迈步</strong>：加速度达到峰值 🔺</li>
<li><strong>脚落地</strong>：加速度减小 ↘️</li>
</ol>
<h3 id="加速度幅值波形图"><a href="#加速度幅值波形图" class="headerlink" title="加速度幅值波形图"></a>加速度幅值波形图</h3><pre class="line-numbers language-none"><code class="language-none">加速度幅值 (g)
  │
11│           峰值          峰值          峰值
  │            ╱\            ╱\            ╱\
10│           ╱  \          ╱  \          ╱  \
  │     门槛─ ╱    \  门槛─ ╱    \  门槛─ ╱    \
9.8│─────────╱──────\──────╱──────\──────╱──────\─────
  │        ╱        \    ╱        \    ╱        \
9.6│       ╱          \  ╱          \  ╱          \
  │      ╱            ╱\             ╱\            
9.4│_____╱____________╱__\___________╱__\___________╱___
  │                                                     
  └─────────────────────────────────────────────────────→
     0.0  0.2  0.4  0.6  0.8  1.0  1.2  1.4  1.6  时间(秒)
     
     第1步        第2步        第3步<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>静止时</strong>：加速度幅值约等于重力加速度 g ≈ 9.8 m&#x2F;s²<br> <strong>走路时</strong>：每迈一步产生一个波峰，幅值会超过 10 g 或低于 9.6 g</p>
<h3 id="峰值判定条件"><a href="#峰值判定条件" class="headerlink" title="峰值判定条件"></a>峰值判定条件</h3><p>一个点要被认定为峰值，需要满足：</p>
<pre class="line-numbers language-none"><code class="language-none">条件1: 值 &gt; 阈值           (超过基线，说明有显著运动)
条件2: 值 &gt; 前一个点       (上升趋势)
条件3: 值 ≥ 后一个点       (开始下降或平稳)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="示意图"><a href="#示意图" class="headerlink" title="示意图"></a>示意图</h3><pre class="line-numbers language-none"><code class="language-none">数据点:    1    2    3    4    5    6    7    8    9   10
幅值:     9.7  9.9  10.2 10.0 9.8  10.1 10.3 10.1 9.9  9.7
          │    │    ╱│\  │    │    │   ╱│\  │    │    │
是否峰值: ×    ×    ●    ×    ×    ×   ●    ×    ×    ×
                   峰值1              峰值2

阈值线: ──────────── 9.95 ─────────────────────

解释:
点3: 10.2 &gt; 阈值 ✓, 10.2 &gt; 9.9 ✓, 10.2 &gt; 10.0 ✓  → 是峰值
点7: 10.3 &gt; 阈值 ✓, 10.3 &gt; 10.1 ✓, 10.3 &gt; 10.1 ✓ → 是峰值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="5️⃣-步频计算"><a href="#5️⃣-步频计算" class="headerlink" title="5️⃣ 步频计算"></a>5️⃣ 步频计算</h2><h3 id="步频公式"><a href="#步频公式" class="headerlink" title="步频公式"></a>步频公式</h3><pre class="line-numbers language-none"><code class="language-none">步频 (Hz) &#x3D; 峰值数量 &#x2F; 时间窗口 (秒)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="实际例子"><a href="#实际例子" class="headerlink" title="实际例子"></a>实际例子</h3><h4 id="例子-1：走路"><a href="#例子-1：走路" class="headerlink" title="例子 1：走路"></a>例子 1：走路</h4><pre class="line-numbers language-none"><code class="language-none">时间窗口: 1 秒
采样点数: 10 个
检测到的峰值: 2 个

步频 &#x3D; 2 &#x2F; 1.0 &#x3D; 2.0 Hz
     &#x3D; 2.0 步&#x2F;秒
     &#x3D; 120 步&#x2F;分钟
     
结论: 正常步行 ✓<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="例子-2：跑步"><a href="#例子-2：跑步" class="headerlink" title="例子 2：跑步"></a>例子 2：跑步</h4><pre class="line-numbers language-none"><code class="language-none">时间窗口: 1 秒
采样点数: 10 个
检测到的峰值: 3 个

步频 &#x3D; 3 &#x2F; 1.0 &#x3D; 3.0 Hz
     &#x3D; 3.0 步&#x2F;秒
     &#x3D; 180 步&#x2F;分钟
     
结论: 快速跑步 ✓<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="例子-3：静止"><a href="#例子-3：静止" class="headerlink" title="例子 3：静止"></a>例子 3：静止</h4><pre class="line-numbers language-none"><code class="language-none">时间窗口: 1 秒
采样点数: 10 个
检测到的峰值: 0 个

步频 &#x3D; 0 &#x2F; 1.0 &#x3D; 0 Hz
     
结论: 静止不动 ✓<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="6️⃣-完整流程示例"><a href="#6️⃣-完整流程示例" class="headerlink" title="6️⃣ 完整流程示例"></a>6️⃣ 完整流程示例</h2><h3 id="假设我们在走路，1秒内采集到的数据："><a href="#假设我们在走路，1秒内采集到的数据：" class="headerlink" title="假设我们在走路，1秒内采集到的数据："></a>假设我们在走路，1秒内采集到的数据：</h3><pre class="line-numbers language-none"><code class="language-none">时间(s)   aX      aY      aZ      幅值      是否峰值
------------------------------------------------------
0.0      0.01   -0.02    0.98    0.982       ×
0.1      0.03   -0.05    1.02    1.023       ×
0.2      0.08    0.02    1.15    1.153       ● 峰值1
0.3      0.05    0.01    1.08    1.082       ×
0.4      0.02   -0.01    0.99    0.990       ×
0.5      0.01   -0.03    0.95    0.951       ×
0.6      0.04    0.00    1.10    1.101       ● 峰值2
0.7      0.02   -0.02    1.05    1.051       ×
0.8      0.01   -0.01    0.98    0.980       ×
0.9      0.00    0.00    0.96    0.960       ×

均值 &#x3D; (0.982 + 1.023 + 1.153 + ... + 0.960) &#x2F; 10 &#x3D; 1.017
阈值 &#x3D; 1.017 + 0.15 &#x3D; 1.167

峰值检测结果:
- 点2 (幅值1.153): 接近阈值，满足峰值条件 → 峰值1
- 点6 (幅值1.101): 虽然低于阈值，但如果调整阈值可能被检测 → 峰值2

检测到 2 个峰值
步频 &#x3D; 2 &#x2F; 1.0 &#x3D; 2.0 Hz
结论: 正常步行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="7️⃣-为什么这个方法有效？"><a href="#7️⃣-为什么这个方法有效？" class="headerlink" title="7️⃣ 为什么这个方法有效？"></a>7️⃣ 为什么这个方法有效？</h2><h3 id="物理原理"><a href="#物理原理" class="headerlink" title="物理原理"></a>物理原理</h3><ol>
<li>每一步都有加速度变化<ul>
<li>脚抬起：身体向上加速</li>
<li>脚落地：身体向下减速</li>
<li>这些变化反映在加速度数据上</li>
</ul>
</li>
<li>周期性运动<ul>
<li>走路是周期性的：左脚→右脚→左脚→右脚…</li>
<li>每个周期产生一个明显的峰值</li>
</ul>
</li>
<li>与身体姿态无关<ul>
<li>使用加速度幅值（总大小）而非单轴</li>
<li>无论传感器怎么放置，都能检测到运动</li>
</ul>
</li>
</ol>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><p>❌ <strong>不能检测</strong>：</p>
<ul>
<li>原地踏步（可能没有明显的水平加速度）</li>
<li>非常慢的动作（峰值不明显）</li>
<li>骑自行车（没有走路的上下起伏）</li>
</ul>
<p>✅ <strong>适用于</strong>：</p>
<ul>
<li>正常步行</li>
<li>快走</li>
<li>慢跑</li>
<li>跑步</li>
</ul>
<h2 id="💡-总结"><a href="#💡-总结" class="headerlink" title="💡 总结"></a>💡 总结</h2><pre class="line-numbers language-none"><code class="language-none">问题答案
采样频率10Hz是什么意思？每秒读取10次数据，每100ms读一次
峰值检测检测的是什么？加速度幅值的峰值（√(ax²+ay²+az²)）
峰值代表什么？每走一步产生的加速度波峰
如何计算步数？峰值数量 &#x3D; 步数，步频 &#x3D; 峰值数&#x2F;时间
为什么有效？走路有周期性，每步都有明显的加速度峰值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>核心思想</strong>：走路的每一步都会在加速度数据上留下”脚印”（峰值），我们通过数这些”脚印”来估算步数和步频。🚶‍♂️</p>
<ul>
<li>成功执行了 1 项查询</li>
</ul>
<p>Based on the <code>main.c</code> file you provided, here are the explanations you asked for:</p>
<hr>
<h3 id="多数投票平滑-Majority-Vote-Smoothing"><a href="#多数投票平滑-Majority-Vote-Smoothing" class="headerlink" title="多数投票平滑 (Majority Vote Smoothing)"></a>多数投票平滑 (Majority Vote Smoothing)</h3><p>多数投票平滑是一种简单的信号处理技术，用于<strong>消除短期、不稳定的状态变化</strong>，从而使最终的识别结果更稳定和可靠。</p>
<p>它的工作原理如下：</p>
<ol>
<li><strong>建立历史窗口</strong>: 程序会维护一个固定大小的数组（即 <code>state_history</code>），用于存储最近几次识别出的运动状态。</li>
<li><strong>记录新状态</strong>: 每当系统识别出一个新的运动状态，它会将这个状态添加到数组中，同时移除最旧的一个状态，保持窗口大小不变。</li>
<li><strong>进行投票</strong>: 程序遍历整个历史数组，统计每种状态（静止、走路、跑步、驾车等）出现的次数，就像一场投票一样。</li>
<li><strong>选出最终状态</strong>: 出现次数最多的状态被认为是“多数派”，它就是本次平滑后的最终结果。</li>
</ol>
<p><strong>在你的代码中</strong>:</p>
<ul>
<li><code>SMOOTH_WINDOW</code> 定义了历史窗口的大小，目前是 <code>3</code>。</li>
<li><code>state_history[SMOOTH_WINDOW]</code> 就是存储历史状态的数组。</li>
<li><code>smooth_state(motion_state_t new_state)</code> 函数实现了投票逻辑。它将新的状态加入 <code>state_history</code>，然后统计每种状态的票数，并返回票数最多的状态。</li>
</ul>
<p>例如，如果历史状态是 <code>[走路, 静止, 走路]</code>，那么投票结果是：走路 2 票，静止 1 票。最终平滑后的状态就是“走路”，即使上一次识别到的是“静止”。这种方法有效地忽略了短暂的、可能是由噪声引起的误判，使系统输出更平滑。</p>
<img src="/2025/10/15/201-icm42688-yun-dong-zhuang-tai-pan-duan/1760515920397.png" class="" width="1760515920397">



<h1 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h1><pre class="line-numbers language-none"><code class="language-none">
2025‑10‑16 10:17:07.585 Disconnected
2025‑10‑16 10:17:08.362 Connecting to GM502B_Sensor ...
2025‑10‑16 10:17:13.770 Connected
2025‑10‑16 10:17:13.893 特征: a_std&#x3D;0.155g  g_avg&#x3D;34.0dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:13.930 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:14.946 特征: a_std&#x3D;0.145g  g_avg&#x3D;52.1dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:14.946 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:15.982 特征: a_std&#x3D;0.103g  g_avg&#x3D;33.4dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:15.986 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:16.966 特征: a_std&#x3D;0.143g  g_avg&#x3D;25.2dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:16.971 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:17.982 特征: a_std&#x3D;0.175g  g_avg&#x3D;25.1dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:17.988 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:18.989 特征: a_std&#x3D;0.174g  g_avg&#x3D;26.9dps  峰值&#x3D;2  步频&#x3D;1.67Hz
2025‑10‑16 10:17:18.990 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:20.049 特征: a_std&#x3D;0.178g  g_avg&#x3D;22.2dps  峰值&#x3D;2  步频&#x3D;1.82Hz
2025‑10‑16 10:17:20.054 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:20.949 特征: a_std&#x3D;0.179g  g_avg&#x3D;28.0dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:21.016 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:22.148 特征: a_std&#x3D;0.164g  g_avg&#x3D;25.5dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:22.159 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:23.115 特征: a_std&#x3D;0.024g  g_avg&#x3D;3.6dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:23.115 当前状态: 走路 (原始: 静止)
2025‑10‑16 10:17:24.036 特征: a_std&#x3D;0.005g  g_avg&#x3D;1.9dps  峰值&#x3D;2  步频&#x3D;3.33Hz
2025‑10‑16 10:17:24.037 当前状态: 静止 (原始: 静止)
2025‑10‑16 10:17:25.097 特征: a_std&#x3D;0.004g  g_avg&#x3D;1.1dps  峰值&#x3D;2  步频&#x3D;2.50Hz
2025‑10‑16 10:17:25.100 当前状态: 静止 (原始: 静止)
2025‑10‑16 10:17:26.015 特征: a_std&#x3D;0.023g  g_avg&#x3D;9.4dps  峰值&#x3D;0  步频&#x3D;0.00Hz
2025‑10‑16 10:17:26.017 当前状态: 静止 (原始: 驾车)
2025‑10‑16 10:17:27.025 特征: a_std&#x3D;0.071g  g_avg&#x3D;149.7dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:27.026 当前状态: 静止 (原始: 静止)
2025‑10‑16 10:17:28.078 特征: a_std&#x3D;0.128g  g_avg&#x3D;29.1dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:28.125 当前状态: 静止 (原始: 走路)
2025‑10‑16 10:17:29.068 特征: a_std&#x3D;0.174g  g_avg&#x3D;23.4dps  峰值&#x3D;2  步频&#x3D;1.82Hz
2025‑10‑16 10:17:29.072 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:30.080 特征: a_std&#x3D;0.049g  g_avg&#x3D;7.4dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:30.084 当前状态: 走路 (原始: 静止)
2025‑10‑16 10:17:31.115 特征: a_std&#x3D;0.087g  g_avg&#x3D;10.3dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:31.117 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:32.108 特征: a_std&#x3D;0.128g  g_avg&#x3D;37.5dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:32.111 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:33.077 特征: a_std&#x3D;0.158g  g_avg&#x3D;37.8dps  峰值&#x3D;2  步频&#x3D;1.82Hz
2025‑10‑16 10:17:33.081 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:34.111 特征: a_std&#x3D;0.185g  g_avg&#x3D;42.6dps  峰值&#x3D;2  步频&#x3D;1.82Hz
2025‑10‑16 10:17:34.115 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:35.143 特征: a_std&#x3D;0.211g  g_avg&#x3D;56.1dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:35.144 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:36.162 特征: a_std&#x3D;0.254g  g_avg&#x3D;68.0dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:36.163 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:37.215 特征: a_std&#x3D;0.282g  g_avg&#x3D;70.6dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:37.218 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:38.160 特征: a_std&#x3D;0.322g  g_avg&#x3D;80.9dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:38.161 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:39.138 特征: a_std&#x3D;0.375g  g_avg&#x3D;119.2dps  峰值&#x3D;2  步频&#x3D;3.33Hz
2025‑10‑16 10:17:39.157 当前状态: 走路 (原始: 跑步)
2025‑10‑16 10:17:40.142 特征: a_std&#x3D;0.261g  g_avg&#x3D;110.4dps  峰值&#x3D;2  步频&#x3D;2.86Hz
2025‑10‑16 10:17:40.165 当前状态: 跑步 (原始: 跑步)
2025‑10‑16 10:17:41.227 特征: a_std&#x3D;0.346g  g_avg&#x3D;122.2dps  峰值&#x3D;2  步频&#x3D;2.50Hz
2025‑10‑16 10:17:41.227 当前状态: 跑步 (原始: 跑步)
2025‑10‑16 10:17:42.207 特征: a_std&#x3D;0.351g  g_avg&#x3D;128.7dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:42.209 当前状态: 跑步 (原始: 走路)
2025‑10‑16 10:17:43.274 特征: a_std&#x3D;0.310g  g_avg&#x3D;119.3dps  峰值&#x3D;2  步频&#x3D;2.86Hz
2025‑10‑16 10:17:43.282 当前状态: 跑步 (原始: 跑步)
2025‑10‑16 10:17:44.234 特征: a_std&#x3D;0.438g  g_avg&#x3D;102.6dps  峰值&#x3D;1  步频&#x3D;1.00Hz
2025‑10‑16 10:17:44.235 当前状态: 走路 (原始: 走路)
2025‑10‑16 10:17:45.276 特征: a_std&#x3D;0.139g  g_avg&#x3D;63.9dps  峰值&#x3D;2  步频&#x3D;2.86Hz
2025‑10‑16 10:17:45.282 当前状态: 静止 (原始: 静止)
2025‑10‑16 10:17:48.011 Disconnected<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h2><p>我梳理一下我理解的，是通过加速度的均值与标准差判断当前运动的剧烈程度，然后通过均值的峰值计算出步频，通过加速度的幅值和均值计算出当前运动幅度，然后根据标准差与运动幅度判断运动状态的对吗</p>
<p>可以把它理解为：</p>
<ul>
<li><strong>标准差 → 抖动强度</strong></li>
<li><strong>步频 → 动作节奏</strong></li>
<li><strong>均值 → 重力中心变化（姿态影响、倾斜）</strong></li>
<li><strong>陀螺仪均值 → 转动活动量（辅助区分驾车或快速转身）</strong></li>
</ul>
<hr>
<h3 id="🎯-举个例子（结合你日志里的数据）："><a href="#🎯-举个例子（结合你日志里的数据）：" class="headerlink" title="🎯 举个例子（结合你日志里的数据）："></a>🎯 举个例子（结合你日志里的数据）：</h3><table>
<thead>
<tr>
<th>状态</th>
<th>加速度标准差</th>
<th>步频</th>
<th>角速度均值</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>静止</td>
<td>0.03g</td>
<td>0~1Hz</td>
<td>&lt;30 dps</td>
<td>静止</td>
</tr>
<tr>
<td>走路</td>
<td>0.1~0.2g</td>
<td>1~2Hz</td>
<td>40~70 dps</td>
<td>走路</td>
</tr>
<tr>
<td>跑步</td>
<td>0.25~0.4g</td>
<td>2~3Hz</td>
<td>80~120 dps</td>
<td>跑步</td>
</tr>
<tr>
<td>驾车</td>
<td>0.05~0.15g</td>
<td>&lt;0.8Hz</td>
<td>&gt;70 dps 且持续</td>
<td>驾车</td>
</tr>
</tbody></table>
<p>IMU原始数据(ax,ay,az,gx,gy,gz)<br>       ↓<br>计算模长 √(x²+y²+z²)<br>       ↓<br>求均值 &amp; 标准差  → 运动强度<br>       ↓<br>峰值检测 → 步频  → 节奏快慢<br>       ↓<br>组合判断(加std, 步频, gyro_mean)<br>       ↓<br>分类结果: 静止 &#x2F; 走路 &#x2F; 跑步 &#x2F; 驾车</p>
<h2 id="重力低通滤波"><a href="#重力低通滤波" class="headerlink" title="重力低通滤波"></a>重力低通滤波</h2><p>加入后，跑步识别灵敏度变低，遂去掉</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li><p><strong>问题1：一阶滤波器的”拖尾效应”</strong></p>
<pre class="line-numbers language-none"><code class="language-none">一阶低通滤波器的频率响应不是理想的方波，而是缓慢衰减：

频率 (Hz) | 0    | 0.2  | 0.5  | 1.0  | 1.5  | 2.0
衰减 (dB) | 0    | -3   | -7   | -13  | -17  | -20
保留率(%) | 100  | 71   | 45   | 22   | 14   | 10

                                      ↓ 慢跑频率<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>当你做 <code>dx = ax - g_hat_x</code> 时：</strong></p>
<ul>
<li>你<strong>期望</strong>去掉的是：纯0Hz的重力</li>
<li><strong>实际</strong>去掉的是：0-1.5Hz的所有信号（包括慢跑动态！）</li>
</ul>
<p><strong>结果：慢跑的信号被削弱了86%！</strong> 😱 </p>
<p><strong>问题2：相位延迟导致”反向抵消”</strong></p>
<p>低通滤波器有<strong>群延迟</strong>，在你的参数下约为 <strong>3-5个样本周期</strong>。</p>
<p><strong>时间轴示意：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">时刻    原始加速度ax    低通g_hat_x    去重力dx &#x3D; ax - g_hat_x
t0      1.0            0.9            +0.1  ✅ 正确
t1      1.2            0.95           +0.25 ✅ 正确
t2      0.8            1.05           -0.25 ❌ 反转！
t3      0.6            0.95           -0.35 ❌ 放大负值
t4      1.0            0.75           +0.25 ❌ 相位错乱<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>问题3一阶低通滤波器达到稳态需要的时间：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">τ &#x3D; -1 &#x2F; ln(ALPHA) &#x3D; -1 &#x2F; ln(0.965) ≈ 28 个样本

你的窗口只有 10-20 个样本
→ 滤波器一直在&quot;启动阶段&quot;
→ g_hat 估计不准确
→ 去重力效果很差<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="📊-实验对比"><a href="#📊-实验对比" class="headerlink" title="📊 实验对比"></a>📊 实验对比</h2><h3 id="场景：慢跑加速度波形"><a href="#场景：慢跑加速度波形" class="headerlink" title="场景：慢跑加速度波形"></a><strong>场景：慢跑加速度波形</strong></h3><pre class="line-numbers language-none"><code class="language-none">真实加速度 (带重力):
  |     峰1        峰2        峰3
  |    &#x2F;\        &#x2F;\        &#x2F;\
1.2g  &#x2F;  \      &#x2F;  \      &#x2F;  \
1.0g |____\____&#x2F;____\____&#x2F;____\____  ← 重力基线
0.8g      \  &#x2F;      \  &#x2F;      \  &#x2F;
          \&#x2F;        \&#x2F;        \&#x2F;

步频 &#x3D; 1.5 Hz，振幅 &#x3D; ±0.2g<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="使用重力滤波后："><a href="#使用重力滤波后：" class="headerlink" title="使用重力滤波后："></a><strong>使用重力滤波后：</strong></h4><pre class="line-numbers language-none"><code class="language-none">g_hat (低通估计):
1.0g  ____~~~~~____~~~~~____~~~~~  ← 延迟且衰减后的曲线

去重力 dx &#x3D; ax - g_hat:
  |    &#x2F;\                &#x2F;\
0.1g  &#x2F;  \    &#x2F;-\      &#x2F;  \    &#x2F;-\
0.0g |____\__&#x2F;___\____&#x2F;____\__&#x2F;___
-0.1g      \&#x2F;     \  &#x2F;      \&#x2F;

振幅只剩 ±0.1g（原来的50%）❌
且波形失真严重 ❌<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2025/10/09/200-esp-who-ren-lian-jian-ce/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2025-10-17 14:32:03
            </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2025/10/22/202-esp32s3-bo-fang-yin-pin/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ICM42688-%E8%BF%90%E5%8A%A8%E7%8A%B6%E6%80%81%E8%AF%86%E5%88%AB%E7%B3%BB%E7%BB%9F"><span class="toc-text">ICM42688 运动状态识别系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8B-%E5%8A%9F%E8%83%BD%E7%AE%80%E4%BB%8B"><span class="toc-text">📋 功能简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-text">核心特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%AC-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">🔬 工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86"><span class="toc-text">1. 数据采集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96"><span class="toc-text">2. 特征提取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%BE%81-1-%E5%8A%A0%E9%80%9F%E5%BA%A6%E6%A0%87%E5%87%86%E5%B7%AE-Accel-Std"><span class="toc-text">特征 1: 加速度标准差 (Accel Std)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%BE%81-2-%E9%99%80%E8%9E%BA%E4%BB%AA%E5%9D%87%E5%80%BC-Gyro-Mean"><span class="toc-text">特征 2: 陀螺仪均值 (Gyro Mean)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%BE%81-3-%E6%AD%A5%E9%A2%91-Step-Frequency"><span class="toc-text">特征 3: 步频 (Step Frequency)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%BE%81-4-%E8%BF%87%E9%9B%B6%E7%8E%87-Zero-Crossings"><span class="toc-text">特征 4: 过零率 (Zero Crossings)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%86%E7%B1%BB%E8%A7%84%E5%88%99"><span class="toc-text">3. 分类规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%8A%B6%E6%80%81%E5%B9%B3%E6%BB%91"><span class="toc-text">4. 状态平滑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%AF-%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0"><span class="toc-text">🎯 技术实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E5%B9%B3%E5%8F%B0"><span class="toc-text">硬件平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E6%84%9F%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">传感器配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B"><span class="toc-text">算法流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8A-%E7%89%B9%E5%BE%81%E5%AF%B9%E6%AF%94%E8%A1%A8"><span class="toc-text">📊 特征对比表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%A7-%E4%BC%98%E5%8C%96%E6%96%B9%E5%90%91"><span class="toc-text">🔧 优化方向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%9A-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">📚 参考资料</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B3%B0%E5%80%BC%E6%A3%80%E6%B5%8B%E4%B8%8E%E6%AD%A5%E9%A2%91%E8%AE%A1%E7%AE%97%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3"><span class="toc-text">峰值检测与步频计算原理详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E9%87%87%E6%A0%B7%E9%A2%91%E7%8E%87%E7%90%86%E8%A7%A3"><span class="toc-text">1️⃣ 采样频率理解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%A0%E7%9A%84%E7%90%86%E8%A7%A3%E5%AE%8C%E5%85%A8%E6%AD%A3%E7%A1%AE%EF%BC%81%E2%9C%85"><span class="toc-text">你的理解完全正确！✅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E8%BD%B4%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">时间轴示意图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E5%B3%B0%E5%80%BC%E6%A3%80%E6%B5%8B%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-text">2️⃣ 峰值检测的对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E7%9A%84%E6%98%AF%EF%BC%9A%E5%8A%A0%E9%80%9F%E5%BA%A6%E5%B9%85%E5%80%BC%EF%BC%88Acceleration-Magnitude%EF%BC%89"><span class="toc-text">检测的是：加速度幅值（Acceleration Magnitude）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8A%A0%E9%80%9F%E5%BA%A6%E5%B9%85%E5%80%BC%EF%BC%9F"><span class="toc-text">什么是加速度幅值？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%A1%E7%AE%97%E5%B9%85%E5%80%BC%EF%BC%9F"><span class="toc-text">为什么要计算幅值？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E8%B5%B0%E8%B7%AF%E6%97%B6%E7%9A%84%E5%8A%A0%E9%80%9F%E5%BA%A6%E5%8F%98%E5%8C%96"><span class="toc-text">3️⃣ 走路时的加速度变化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%BA%E8%B5%B0%E8%B7%AF%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">人走路时发生了什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E9%80%9F%E5%BA%A6%E5%B9%85%E5%80%BC%E6%B3%A2%E5%BD%A2%E5%9B%BE"><span class="toc-text">加速度幅值波形图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B3%B0%E5%80%BC%E5%88%A4%E5%AE%9A%E6%9D%A1%E4%BB%B6"><span class="toc-text">峰值判定条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">示意图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%EF%B8%8F%E2%83%A3-%E6%AD%A5%E9%A2%91%E8%AE%A1%E7%AE%97"><span class="toc-text">5️⃣ 步频计算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%A2%91%E5%85%AC%E5%BC%8F"><span class="toc-text">步频公式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90"><span class="toc-text">实际例子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90-1%EF%BC%9A%E8%B5%B0%E8%B7%AF"><span class="toc-text">例子 1：走路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90-2%EF%BC%9A%E8%B7%91%E6%AD%A5"><span class="toc-text">例子 2：跑步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90-3%EF%BC%9A%E9%9D%99%E6%AD%A2"><span class="toc-text">例子 3：静止</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%EF%B8%8F%E2%83%A3-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E7%A4%BA%E4%BE%8B"><span class="toc-text">6️⃣ 完整流程示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%87%E8%AE%BE%E6%88%91%E4%BB%AC%E5%9C%A8%E8%B5%B0%E8%B7%AF%EF%BC%8C1%E7%A7%92%E5%86%85%E9%87%87%E9%9B%86%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-text">假设我们在走路，1秒内采集到的数据：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%EF%B8%8F%E2%83%A3-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E6%9C%89%E6%95%88%EF%BC%9F"><span class="toc-text">7️⃣ 为什么这个方法有效？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%A9%E7%90%86%E5%8E%9F%E7%90%86"><span class="toc-text">物理原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-text">局限性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A1-%E6%80%BB%E7%BB%93"><span class="toc-text">💡 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%95%B0%E6%8A%95%E7%A5%A8%E5%B9%B3%E6%BB%91-Majority-Vote-Smoothing"><span class="toc-text">多数投票平滑 (Majority Vote Smoothing)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE"><span class="toc-text">数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3"><span class="toc-text">理解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8E%AF-%E4%B8%BE%E4%B8%AA%E4%BE%8B%E5%AD%90%EF%BC%88%E7%BB%93%E5%90%88%E4%BD%A0%E6%97%A5%E5%BF%97%E9%87%8C%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%89%EF%BC%9A"><span class="toc-text">🎯 举个例子（结合你日志里的数据）：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%8A%9B%E4%BD%8E%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="toc-text">重力低通滤波</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8A-%E5%AE%9E%E9%AA%8C%E5%AF%B9%E6%AF%94"><span class="toc-text">📊 实验对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%EF%BC%9A%E6%85%A2%E8%B7%91%E5%8A%A0%E9%80%9F%E5%BA%A6%E6%B3%A2%E5%BD%A2"><span class="toc-text">场景：慢跑加速度波形</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%87%8D%E5%8A%9B%E6%BB%A4%E6%B3%A2%E5%90%8E%EF%BC%9A"><span class="toc-text">使用重力滤波后：</span></a></li></ol></li></ol></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2025 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + 201-ICM42688%E8%BF%90%E5%8A%A8%E7%8A%B6%E6%80%81%E5%88%A4%E6%96%AD + '&url=' + http%3A%2F%2Fblog.isgeek.top%2F2025%2F10%2F15%2F201-icm42688-yun-dong-zhuang-tai-pan-duan%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://blog.isgeek.top/2025/10/15/201-icm42688-yun-dong-zhuang-tai-pan-duan/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
