<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="南北的猫" />
  <!-- Open Graph Description 简短摘要-->
  
  <!-- 用于搜索引擎的文章摘要 -->
  
  
  
  <title>
    
      ESP_IDF_OTA 
      
      
      |
    
     南北的猫
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  
    
<link rel="stylesheet" href="/css/figcaption/mac-block.css">

  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Northcat</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">ESP_IDF_OTA</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2025-09-01 09:44:10
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="Tags"></i>
                
                <span class="span--tag mr-8">
                  <a href="/tags/ESP-IDF/" title="ESP-IDF">
                    #ESP-IDF
                  </a>
                </span>
                
                <span class="span--tag mr-8">
                  <a href="/tags/ESP32/" title="ESP32">
                    #ESP32
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul>
<li>ESP-IDF</li>
<li><a target="_blank" rel="noopener" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/system/ota">esp-idf&#x2F;examples&#x2F;system&#x2F;ota at v5.4.2 · espressif&#x2F;esp-idf</a></li>
</ul>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>使用<code>simple_ota_example</code>例程，<strong>带证书</strong></p>
<p>然后需要设置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">idf.py menuconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>或者</p>
<p>在<code>sdkconfig</code>中修改<code>wifi</code>与<code>otaurl</code></p>
<pre class="line-numbers language-none"><code class="language-none">CONFIG_EXAMPLE_PROVIDE_WIFI_CONSOLE_CMD&#x3D;y
CONFIG_EXAMPLE_WIFI_SSID&#x3D;&quot;VIBTEK-2.4G&quot;
CONFIG_EXAMPLE_WIFI_PASSWORD&#x3D;&quot;vibrantech@1305-1&quot;
CONFIG_EXAMPLE_WIFI_CONN_MAX_RETRY&#x3D;6
# CONFIG_EXAMPLE_WIFI_SCAN_METHOD_FAST is not set
CONFIG_EXAMPLE_WIFI_SCAN_METHOD_ALL_CHANNEL&#x3D;y

#
# Example Configuration
#
CONFIG_EXAMPLE_FIRMWARE_UPGRADE_URL&#x3D;&quot;http:&#x2F;&#x2F;192.168.71.92:8070&#x2F;Ble_WIFI_Sniff.bin&quot;
CONFIG_EXAMPLE_USE_CERT_BUNDLE&#x3D;y
# CONFIG_EXAMPLE_SKIP_COMMON_NAME_CHECK is not set
# CONFIG_EXAMPLE_FIRMWARE_UPGRADE_BIND_IF is not set
# end of Example Configuration<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><ol>
<li></li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">W (370) spi_flash: Detected size(16384k) larger than the size in the binary image header(4096k). Using the size in the binary image header.
I (383) sleep_gpio: Configure to isolate all GPIO pins in sleep state
I (389) sleep_gpio: Enable automatic switching of GPIO sleep configuration
I (396) main_task: Started on CPU0
I (416) main_task: Calling app_main()
I (416) simple_ota_example: OTA example app_main start
I (426) simple_ota_example: SHA-256 for bootloader:  f1b11e5ba4d1158e2ac22cac2f4f6568ffaeb690986a2ffcfc2a90585f89ba83
I (506) simple_ota_example: SHA-256 for current firmware:  e1dbfe46dbbb4c4ba8e809a818c0c7157246c6aa65e1e8287c2b57c05d7cea40
I (506) example_connect: Start example_connect.
I (506) pp: pp rom version: e7ae62f
I (516) net80211: net80211 rom version: e7ae62f
I (526) wifi:wifi driver task: 3fcac520, prio:23, stack:6656, core&#x3D;0
I (526) wifi:wifi firmware version: 48ea317a7
I (526) wifi:wifi certification version: v7.0
I (526) wifi:config NVS flash: enabled
I (536) wifi:config nano formatting: disabled
I (536) wifi:Init data frame dynamic rx buffer num: 32
I (546) wifi:Init static rx mgmt buffer num: 5
I (546) wifi:Init management short buffer num: 32
I (556) wifi:Init dynamic tx buffer num: 32
I (556) wifi:Init static tx FG buffer num: 2
I (556) wifi:Init static rx buffer size: 1600
I (566) wifi:Init static rx buffer num: 10
I (566) wifi:Init dynamic rx buffer num: 32
I (576) wifi_init: rx ba win: 6
I (576) wifi_init: accept mbox: 6
I (576) wifi_init: tcpip mbox: 32
I (576) wifi_init: udp mbox: 6
I (586) wifi_init: tcp mbox: 6
I (586) wifi_init: tcp tx win: 5760
I (586) wifi_init: tcp rx win: 5760
I (596) wifi_init: tcp mss: 1440
I (596) wifi_init: WiFi IRAM OP enabled
I (596) wifi_init: WiFi RX IRAM OP enabled
I (606) phy_init: phy_version 680,a6008b2,Jun  4 2024,16:41:10
I (646) wifi:mode : sta (d8:3b:da:70:62:00)
I (646) wifi:enable tsf
I (646) example_connect: Connecting to VIBTEK-2.4G...
W (646) wifi:Password length matches WPA2 standards, authmode threshold changes from OPEN to WPA2
I (656) example_connect: Waiting for IP(s)
I (3506) wifi:new:&lt;1,0&gt;, old:&lt;1,0&gt;, ap:&lt;255,255&gt;, sta:&lt;1,0&gt;, prof:1, snd_ch_cfg:0x0
I (3506) wifi:state: init -&gt; auth (0xb0)
I (3506) wifi:state: auth -&gt; assoc (0x0)
I (3516) wifi:state: assoc -&gt; run (0x10)
I (3646) wifi:connected with VIBTEK-2.4G, aid &#x3D; 17, channel 1, BW20, bssid &#x3D; 58:ea:1f:9a:8b:92
I (3646) wifi:security: WPA2-PSK, phy: bgn, rssi: -39
I (3656) wifi:pm start, type: 1

I (3656) wifi:dp: 1, bi: 102400, li: 3, scale listen interval from 307200 us to 307200 us
I (3666) wifi:set rx beacon pti, rx_bcn_pti: 0, bcn_timeout: 25000, mt_pti: 0, mt_time: 10000        
I (3696) wifi:&lt;ba-add&gt;idx:0 (ifx:0, 58:ea:1f:9a:8b:92), tid:6, ssn:2, winSize:64
I (3696) wifi:&lt;ba-add&gt;idx:1 (ifx:0, 58:ea:1f:9a:8b:92), tid:0, ssn:0, winSize:64
I (3746) wifi:AP&#39;s beacon interval &#x3D; 102400 us, DTIM period &#x3D; 1
I (4696) esp_netif_handlers: example_netif_sta ip: 192.168.71.29, mask: 255.255.255.0, gw: 192.168.71.1
I (4696) example_connect: Got IPv4 event: Interface &quot;example_netif_sta&quot; address: 192.168.71.29       
I (5506) example_connect: Got IPv6 event: Interface &quot;example_netif_sta&quot; address: fe80:0000:0000:0000:da3b:daff:fe70:6200, type: ESP_IP6_ADDR_IS_LINK_LOCAL
I (5506) example_common: Connected to example_netif_sta
I (5506) example_common: - IPv4 address: 192.168.71.29,
I (5516) example_common: - IPv6 address: fe80:0000:0000:0000:da3b:daff:fe70:6200, type: ESP_IP6_ADDR_IS_LINK_LOCAL
I (5526) wifi:Set ps type: 0, coexist: 0

I (5526) simple_ota_example: Starting OTA example task
I (5536) simple_ota_example: Attempting to download update from http:&#x2F;&#x2F;192.168.71.92:8070&#x2F;hello_world.bin
I (5546) main_task: Returned from app_main()
I (5616) esp_https_ota: Starting OTA...
I (5616) esp_https_ota: Writing to &lt;ota_1&gt; partition at offset 0x1d0000
I (10286) esp_image: segment 0: paddr&#x3D;001d0020 vaddr&#x3D;3c030020 size&#x3D;0d6bch ( 54972) map
I (10296) esp_image: segment 1: paddr&#x3D;001dd6e4 vaddr&#x3D;3fc91a40 size&#x3D;02934h ( 10548) 
I (10296) esp_image: segment 2: paddr&#x3D;001e0020 vaddr&#x3D;42000020 size&#x3D;28c4ch (166988) map
I (10316) esp_image: segment 3: paddr&#x3D;00208c74 vaddr&#x3D;3fc94374 size&#x3D;00cfch (  3324) 
I (10316) esp_image: segment 4: paddr&#x3D;00209978 vaddr&#x3D;40374000 size&#x3D;0da40h ( 55872) 
I (10336) esp_image: segment 0: paddr&#x3D;001d0020 vaddr&#x3D;3c030020 size&#x3D;0d6bch ( 54972) map
I (10346) esp_image: segment 1: paddr&#x3D;001dd6e4 vaddr&#x3D;3fc91a40 size&#x3D;02934h ( 10548) 
I (10346) esp_image: segment 2: paddr&#x3D;001e0020 vaddr&#x3D;42000020 size&#x3D;28c4ch (166988) map
I (10366) esp_image: segment 3: paddr&#x3D;00208c74 vaddr&#x3D;3fc94374 size&#x3D;00cfch (  3324) 
I (10366) esp_image: segment 4: paddr&#x3D;00209978 vaddr&#x3D;40374000 size&#x3D;0da40h ( 55872) 
I (10426) simple_ota_example: OTA Succeed, Rebooting...
I (10426) wifi:state: run -&gt; init (0x0)
I (10426) wifi:pm stop, total sleep time: 1349954 us &#x2F; 6768897 us

I (10426) wifi:&lt;ba-del&gt;idx:1, tid:0
I (10426) wifi:&lt;ba-del&gt;idx:0, tid:6
I (10436) wifi:new:&lt;1,0&gt;, old:&lt;1,0&gt;, ap:&lt;255,255&gt;, sta:&lt;1,0&gt;, prof:1, snd_ch_cfg:0x0
I (10486) wifi:flush txq
I (10486) wifi:stop sw txq
I (10486) wifi:lmac stop hw txq
I (10486) wifi:Deinit lldesc rx mblock:10
xESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x40375b3c
--- 0x40375b3c: esp_restart_noos at C:&#x2F;Users&#x2F;VIBTEK&#x2F;esp&#x2F;v5.4&#x2F;esp-idf&#x2F;components&#x2F;esp_system&#x2F;port&#x2F;soc&#x2F;esp32s3&#x2F;system_internal.c:160

SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce2810,len:0x15a0
load:0x403c8700,len:0x4
load:0x403c8704,len:0xd20
load:0x403cb700,len:0x2ee4
entry 0x403c8928
I (31) boot: ESP-IDF v5.4 2nd stage bootloader
I (31) boot: compile time Jul  3 2025 15:12:48
I (31) boot: Multicore bootloader
I (31) boot: chip revision: v0.2
I (34) boot: efuse block revision: v1.3
I (38) boot.esp32s3: Boot SPI Speed : 80MHz
I (42) boot.esp32s3: SPI Mode       : DIO
I (45) boot.esp32s3: SPI Flash Size : 4MB
I (49) boot: Enabling RNG early entropy source...
I (54) boot: Partition Table:
I (56) boot: ## Label            Usage          Type ST Offset   Length
I (62) boot:  0 nvs              WiFi data        01 02 00009000 00006000
I (69) boot:  1 otadata          OTA data         01 00 0000f000 00002000
I (75) boot:  2 phy_init         RF data          01 01 00011000 00001000
I (82) boot:  3 ota_0            OTA app          00 10 00020000 001a9000
I (88) boot:  4 ota_1            OTA app          00 11 001d0000 001a9000
I (95) boot: End of partition table
I (98) esp_image: segment 0: paddr&#x3D;001d0020 vaddr&#x3D;3c030020 size&#x3D;0d6bch ( 54972) map
I (115) esp_image: segment 1: paddr&#x3D;001dd6e4 vaddr&#x3D;3fc91a40 size&#x3D;02934h ( 10548) load
I (118) esp_image: segment 2: paddr&#x3D;001e0020 vaddr&#x3D;42000020 size&#x3D;28c4ch (166988) map
I (150) esp_image: segment 3: paddr&#x3D;00208c74 vaddr&#x3D;3fc94374 size&#x3D;00cfch (  3324) load
I (151) esp_image: segment 4: paddr&#x3D;00209978 vaddr&#x3D;40374000 size&#x3D;0da40h ( 55872) load
I (172) boot: Loaded app from partition at offset 0x1d0000
I (172) boot: Disabling RNG early entropy source...
E (1077) esp_core_dump_flash: No core dump partition found!
E (1077) esp_core_dump_flash: No core dump partition found!
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决：</p>
<blockquote>
<p>可能是由于固件是arduino编译的,并且需要古剑名字要与项目名字一致</p>
</blockquote>
<p>⚠️：出现烧录与ota更新现象不同的情况，先将固件升级到最新</p>
<p>2.一直更新</p>
<blockquote>
<p>代码被配置为在每次启动时都尝试执行 OTA 更新，并且由于您的 OTA 服务器始终提供“相同版本”的固件，导致设备陷入了一个无限更新循环。</p>
</blockquote>
<p>版本管理</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2025/06/24/172-usb-to-ttl-mo-kuai-diy/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2025-09-01 09:44:10
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="Tags"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/ESP-IDF/" title="ESP-IDF">
                        #ESP-IDF
                      </a>
                    </span>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/ESP32/" title="ESP32">
                        #ESP32
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2025/07/08/174-esp32-s3-qu-dong-ws2812-rgb-deng/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-text">环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-text">问题</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2025 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + ESP_IDF_OTA + '&url=' + http%3A%2F%2Fblog.isgeek.top%2F2025%2F07%2F03%2F173-esp-idf-ota%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://blog.isgeek.top/2025/07/03/173-esp-idf-ota/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
