<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="南北的猫" />
  <!-- Open Graph Description 简短摘要-->
  
  <!-- 用于搜索引擎的文章摘要 -->
  
  
  
  <title>
    
      MOS管与开关电路 
      
      
      |
    
     南北的猫
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  
    
<link rel="stylesheet" href="/css/figcaption/mac-block.css">

  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Northcat</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">MOS管与开关电路</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2025-10-06 22:51:28
        </span>
        
      </div>
      <div class="markdown-body">
        <h1 id="Mos管"><a href="#Mos管" class="headerlink" title="Mos管"></a>Mos管</h1><ul>
<li>vgstj（阈值电压）</li>
<li>rdson（导通电阻）</li>
<li>cgs（寄生电容，影响开关时间，与rdson呈反比）</li>
</ul>
<img src="/2025/04/14/135-mos-guan-yu-kai-guan-dian-lu/1748505029921.png" class="" width="1748505029921">

<img src="/2025/04/14/135-mos-guan-yu-kai-guan-dian-lu/1749801559251.png" class="" width="1749801559251">

<p><strong>PMOS</strong>管,体二极管的方向相反</p>
<h2 id="NMOS"><a href="#NMOS" class="headerlink" title="NMOS"></a>NMOS</h2><h3 id="AO3400A"><a href="#AO3400A" class="headerlink" title="AO3400A"></a>AO3400A</h3><ul>
<li><p>1个N沟道 耐压:30V 电流:5.8A</p>
</li>
<li><p><strong>阈值电压：1.4v</strong></p>
</li>
</ul>
<img src="/2025/04/14/135-mos-guan-yu-kai-guan-dian-lu/1748574878064.png" class="" width="1748574878064">

<h3 id="低边开关（Low-Side-Switch）"><a href="#低边开关（Low-Side-Switch）" class="headerlink" title="低边开关（Low-Side Switch）"></a>低边开关（Low-Side Switch）</h3><h3 id="1-电路形式"><a href="#1-电路形式" class="headerlink" title="1. 电路形式"></a>1. 电路形式</h3><pre class="line-numbers language-none"><code class="language-none">+VCC ──→── 负载 ──→──●───┐
                    │   │
                   漏(D) Q1(N-MOS)
                   源(S)
                    │
                   GND<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>Q1</strong>：通常选用 N 沟道（N-MOS），因为其电子迁移率高、导通电阻低、成本低。</li>
<li><strong>门极(G)</strong>：直接由 MCU GPIO（3.3 V 或 5 V）驱动即可，只要保证 V<sub>GS</sub> ≥ V<sub>th</sub>（门源阈值，一般 2–4 V）就能导通。</li>
</ul>
<h3 id="2-工作原理"><a href="#2-工作原理" class="headerlink" title="2. 工作原理"></a>2. 工作原理</h3><ul>
<li><strong>开通</strong>：GPIO 输出高电平（Vsense≈3.3 V），若 V<sub>GS</sub>&#x3D;3.3 V–0 V&#x3D;3.3 V ≥ 阈值，Q1 导通，负载接地，电流流过。</li>
<li><strong>关闭</strong>：GPIO 输出低电平（0 V），V<sub>GS</sub>&#x3D;0 V–0 V&#x3D;0 V＜阈值，Q1 截止，负载无回路，断电。</li>
</ul>
<h3 id="3-优缺点"><a href="#3-优缺点" class="headerlink" title="3. 优缺点"></a>3. 优缺点</h3><table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>驱动简单：门极相对地 (Source&#x3D;GND)</td>
<td>负载公共端浮动：地被切断，会影响 EMI／共模噪声</td>
</tr>
<tr>
<td>N-MOS 导通阻抗低</td>
<td>无法切断负载对地的干扰电流</td>
</tr>
<tr>
<td>成本低，布局方便</td>
<td>负载地线电位不稳定时会给 MCU 带来风险</td>
</tr>
</tbody></table>
<h2 id="PMOS"><a href="#PMOS" class="headerlink" title="PMOS"></a>PMOS</h2><hr>
<h3 id="高边开关（High-Side-Switch）"><a href="#高边开关（High-Side-Switch）" class="headerlink" title="高边开关（High-Side Switch）"></a>高边开关（High-Side Switch）</h3><h3 id="1-P-沟道-MOSFET-简单高边开关"><a href="#1-P-沟道-MOSFET-简单高边开关" class="headerlink" title="1. P 沟道 MOSFET 简单高边开关"></a>1. P 沟道 MOSFET 简单高边开关</h3><pre class="line-numbers language-none"><code class="language-none">+VCC ──●─── 源(S) Q2(P-MOS) 漏(D)───→── 负载 ──→── GND
       │
      R_pullup
      100 kΩ
       │
     Gate ←─ MCU GPIO (3.3 V)／R_gate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>Q2</strong>：P 沟道 MOSFET，源极接 +VCC，漏极接负载。</li>
<li><strong>上拉电阻</strong> R_pullup：保证 Gate 默认与 +VCC 同电位，Q2 关断。</li>
<li><strong>门极驱动</strong>：MCU 低电平拉 Gate→V<sub>GS</sub>&#x3D;0–VCC＜0→Q2 导通；MCU 高电平（3.3 V）时，R_pullup 将 Gate 拉回 +VCC→V<sub>GS</sub>&#x3D;VCC–VCC&#x3D;0 V→Q2 关断。</li>
<li></li>
</ul>
<h3 id="2-N-沟道-MOSFET-“驱动-高边”-方案"><a href="#2-N-沟道-MOSFET-“驱动-高边”-方案" class="headerlink" title="2. N 沟道 MOSFET “驱动+高边” 方案"></a>2. N 沟道 MOSFET “驱动+高边” 方案</h3><pre class="line-numbers language-none"><code class="language-none">+VCC ──●─── 源(S) Q3(N-MOS) 漏(D)───→── 负载 ──→── GND
       │
      Boot-strap &#x2F; 驱动芯片
         ┌───────────┐
         │ Gate Driver│
         └───────────┘
              │
             MCU<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>Q3</strong>：N 沟道 MOSFET 导通电阻更低，适合大电流场合。</li>
<li><strong>高边驱动器</strong>：利用升压（Charge Pump）或 Boot-strap 电路，将 Gate 提升到比 +VCC 更高（如 VCC+10 V），保证 V<sub>GS</sub> ≥ V<sub>th</sub>。</li>
<li><strong>应用</strong>：电机驱动、电源管理 IC、通信开关等对效率和热量敏感的场合。</li>
</ul>
<h3 id="3-工作原理要点"><a href="#3-工作原理要点" class="headerlink" title="3. 工作原理要点"></a>3. 工作原理要点</h3><table>
<thead>
<tr>
<th>方案</th>
<th>导通条件</th>
<th>关断条件</th>
<th>驱动难度</th>
</tr>
</thead>
<tbody><tr>
<td>P-MOS 高边</td>
<td>Gate 拉低 V<sub>GS</sub>&#x3D;0–VCC＜0</td>
<td>Gate&#x3D;VCC V<sub>GS</sub>&#x3D;0</td>
<td>MCU 3.3 V 直接可行</td>
</tr>
<tr>
<td>N-MOS+驱动 高边</td>
<td>Gate 驱到 VCC+ΔV</td>
<td>Gate≈0 或&#x3D;VCC 断开</td>
<td>需外部驱动芯片&#x2F;电荷泵</td>
</tr>
</tbody></table>
<hr>
<h2 id="门极驱动与保护"><a href="#门极驱动与保护" class="headerlink" title="门极驱动与保护"></a>门极驱动与保护</h2><ol>
<li><strong>门极限流电阻</strong>（50–200 Ω）：抑制寄生电容充放电冲击，防止振铃。</li>
<li><strong>栅极保护二极管</strong>：防止 Gate–Source 过压、ESD 损伤。</li>
<li><strong>驱动电平匹配</strong>：确保 V<sub>GS(max)</sub>（常 ±20 V）不被超越。</li>
<li><strong>布线与旁路</strong>：靠近 MOSFET 放置小型旁路电容（100 nF）和大容量电解&#x2F;铝电容，抑制突发电流。</li>
</ol>
<p><strong>高边开关 vs. 低边开关</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>低边开关 (Low-side)</th>
<th>高边开关 (High-side)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>开关位置</strong></td>
<td>负极 (GND) 端串接开关</td>
<td>正极 (VCC) 端串接开关</td>
</tr>
<tr>
<td><strong>常用器件</strong></td>
<td>N 沟道 MOSFET</td>
<td>P 沟道 MOSFET &#x2F; PNP &#x2F; 专用高边开关 IC</td>
</tr>
<tr>
<td><strong>驱动电平</strong></td>
<td>Gate 只要相对于 GND 提高到 ≥V<sub>th</sub> 即可</td>
<td>P 沟端要拉到低于 VCC-V<sub>th</sub>，3.3 V IO 直接很难关断</td>
</tr>
<tr>
<td><strong>优点</strong></td>
<td>驱动简单：ESP32 3.3 V 即可；导通阻抗低；成本低</td>
<td>负载始终与地共地，模拟测量更直观；对地参考不变</td>
</tr>
<tr>
<td><strong>缺点</strong></td>
<td>负载地浮空时，有时候测量参考地不方便</td>
<td>P 沟 R<sub>DS(on)</sub> 通常比 N 沟高；要做电平移位；成本略高</td>
</tr>
</tbody></table>
<h3 id="何时用哪一种？"><a href="#何时用哪一种？" class="headerlink" title="何时用哪一种？"></a>何时用哪一种？</h3><ul>
<li><strong>对地信号敏感（要测 GND 侧电压）</strong><br> 推荐用 <strong>高边开关</strong>，负载地不可切断。</li>
<li><strong>只需控制通／断，又要地参考一致</strong><br> <strong>低边开关</strong> 最简单，用 N 沟 MOSFET 接地端即可。</li>
</ul>
<hr>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul>
<li>你的电路里，Q4 接在 module GND 侧，属于 <strong>低边开关</strong>。只要把 Q4 的 Source 直接接地，Gate 上拉电阻 R22 去掉，就能保证 ESP32 3.3 V 驱动有效关断&#x2F;导通。</li>
<li>如果未来想把开关放在 VCC 侧，就要换成 P 沟 MOSFET（或专用高边开关 IC）＋一个 N 沟做电平移位，才能用 3.3 V GPIO 控制 5 V VCC。</li>
</ul>
<p>这样你就既校验了原理图，也清楚了高、低边开关的原理和选型思路。祝顺利！</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>mos管可做开关使用，nmos比较常用，G极高，则导通，G低则断开，另外，G极通常串联两个电阻，一个是用来<code>限制电流，抑制震荡</code>的,一个是用来<code>下拉到地</code>的。</p>
<p><strong>注意:</strong></p>
<blockquote>
<p>首先单片机io电压要高于<code>vgsth</code>,比如3.3v单片机选择<code>AO3400A</code>,vgsth为1.4v就可以,不可以太大或者太小,会出现无法驱动或者失去开关作用问题</p>
</blockquote>
<h1 id="开关电路图"><a href="#开关电路图" class="headerlink" title="开关电路图"></a>开关电路图</h1><p>这个是按键控制上电状态的电路图</p>
<img src="/2025/04/14/135-mos-guan-yu-kai-guan-dian-lu/1744782871788.png" class="" width="1744782871788">

<p>注意：</p>
<p>供电电流不能太小，否则会一直自动重启</p>
<p><strong>基础开关电路的理解</strong></p>
<p>上半部分是开关机电路，首先Key_BAT被拉高，按键按下后被拉低，mcu控制BAT_Control拉高保持，NPN三极管高电平导通导致AO3401 PMOS的栅极G被拉低，使MOS管导通。</p>
<p><strong>右下角电路是电源切换电路</strong></p>
<p>当电池供电时，Q2的栅极为低电平，Q2截止，但是通过体二极管，将VCC缓慢拉高为4.7V</p>
<p>当usb供电时，Vg由于下拉电阻，电压远小于5v，Vcc&#x3D;5v（如下图可见）,Vgs&lt;0，Q2导通</p>
<p><strong>还是有点困惑</strong></p>
<p><a target="_blank" rel="noopener" href="https://chatgpt.com/share/685e6742-ea44-8008-8e6b-942e1cbcd014">https://chatgpt.com/share/685e6742-ea44-8008-8e6b-942e1cbcd014</a></p>
<img src="/2025/04/14/135-mos-guan-yu-kai-guan-dian-lu/1755150245962.png" class="" width="1755150245962">

<img src="/2025/04/14/135-mos-guan-yu-kai-guan-dian-lu/1755136464584.png" class="" width="1755136464584">

<p>这是开关机电路，当检测到按键按下的时候电路导通，且拉高PCA_IO0_6为高电平，NPN三极管导通，使Pmos持续导通。</p>
<p>⚠️：<strong>三极管需要下拉电阻</strong>，且下拉电阻要在限流电阻的左边</p>
<h2 id="NPN-三极管（S8050）开关电路"><a href="#NPN-三极管（S8050）开关电路" class="headerlink" title="NPN 三极管（S8050）开关电路"></a>NPN 三极管（S8050）开关电路</h2><ul>
<li><strong>原理</strong><ul>
<li>PCA9555 → 基极电阻 → NPN (S8050) → 控制 PMOS 栅极 → 传感器电源。</li>
<li>高电平 → NPN 导通 → 栅极低 → PMOS 开 → 电源接通；</li>
<li>低电平 → NPN 截止 → 栅极被上拉 → PMOS 关断。</li>
</ul>
</li>
<li><strong>问题</strong><ul>
<li>IO 高电平只有 2.6 V，而不是 3.3 V。</li>
<li>关断时 VCC_OUT 仍有 2.6 V，不完全关断。</li>
</ul>
</li>
<li><strong>分析</strong><ol>
<li>IO 电平被基极电流钳位 → 压低到 2.6 V；</li>
<li>NPN 未完全截止，栅极未被拉到 3.3 V；</li>
<li>PMOS Vgs 没完全为 0，半导通。</li>
</ol>
</li>
<li><strong>解决方案</strong><ul>
<li>基极电阻 <strong>1k → 4.7k–10k</strong>；</li>
<li>在基极加 <strong>47k 下拉</strong>；</li>
<li>在 PMOS 栅极加 <strong>10k 上拉</strong>；</li>
<li>必要时更换 PMOS 型号，选择 Vgs(th) 较高、漏电小的型号。</li>
</ul>
</li>
</ul>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/CodeWorkerLiMing/p/12007346.html">MOS管做开关之初理解 - wdliming - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44115082/article/details/109193826">MOS管的使用_mos管限流电路-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Mb4y1k7fd?spm_id_from=333.788.videopod.sections&vd_source=e33ad22b3d91cb180bef532ce5877b2e">【知识】既然有了nmos 为啥还要pmos_哔哩哔哩_bilibili</a></p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2025/04/10/133-esp32-c3-ble/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2025-10-06 22:51:28
            </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2025/04/16/136-chang-yong-dc-dc-xin-pian-fang-an/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mos%E7%AE%A1"><span class="toc-text">Mos管</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NMOS"><span class="toc-text">NMOS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AO3400A"><span class="toc-text">AO3400A</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E8%BE%B9%E5%BC%80%E5%85%B3%EF%BC%88Low-Side-Switch%EF%BC%89"><span class="toc-text">低边开关（Low-Side Switch）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%94%B5%E8%B7%AF%E5%BD%A2%E5%BC%8F"><span class="toc-text">1. 电路形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">2. 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">3. 优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PMOS"><span class="toc-text">PMOS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E8%BE%B9%E5%BC%80%E5%85%B3%EF%BC%88High-Side-Switch%EF%BC%89"><span class="toc-text">高边开关（High-Side Switch）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-P-%E6%B2%9F%E9%81%93-MOSFET-%E7%AE%80%E5%8D%95%E9%AB%98%E8%BE%B9%E5%BC%80%E5%85%B3"><span class="toc-text">1. P 沟道 MOSFET 简单高边开关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-N-%E6%B2%9F%E9%81%93-MOSFET-%E2%80%9C%E9%A9%B1%E5%8A%A8-%E9%AB%98%E8%BE%B9%E2%80%9D-%E6%96%B9%E6%A1%88"><span class="toc-text">2. N 沟道 MOSFET “驱动+高边” 方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E8%A6%81%E7%82%B9"><span class="toc-text">3. 工作原理要点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%A8%E6%9E%81%E9%A9%B1%E5%8A%A8%E4%B8%8E%E4%BF%9D%E6%8A%A4"><span class="toc-text">门极驱动与保护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%95%E6%97%B6%E7%94%A8%E5%93%AA%E4%B8%80%E7%A7%8D%EF%BC%9F"><span class="toc-text">何时用哪一种？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-text">小结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%85%B3%E7%94%B5%E8%B7%AF%E5%9B%BE"><span class="toc-text">开关电路图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NPN-%E4%B8%89%E6%9E%81%E7%AE%A1%EF%BC%88S8050%EF%BC%89%E5%BC%80%E5%85%B3%E7%94%B5%E8%B7%AF"><span class="toc-text">NPN 三极管（S8050）开关电路</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2025 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + MOS%E7%AE%A1%E4%B8%8E%E5%BC%80%E5%85%B3%E7%94%B5%E8%B7%AF + '&url=' + http%3A%2F%2Fblog.isgeek.top%2F2025%2F04%2F14%2F135-mos-guan-yu-kai-guan-dian-lu%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://blog.isgeek.top/2025/04/14/135-mos-guan-yu-kai-guan-dian-lu/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
